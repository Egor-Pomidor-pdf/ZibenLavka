{"ast":null,"code":"import axios from \"axios\";\nconst getAccessToken = () => localStorage.getItem(\"accessToken\");\nconst getRefreshToken = () => localStorage.getItem(\"refreshToken\");\naxios.defaults.headers.common['Authorization'] = `Bearer ${getAccessToken()}`;\naxios.interceptors.response.use(response => response, async error => {\n  var _error$response;\n  const originalRequest = error.config;\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry && getRefreshToken()) {\n    originalRequest._retry = true;\n    try {\n      const response = await axios.post(\"/api/v1/auth/token/refresh/\", {\n        refresh: getRefreshToken()\n      });\n      const newAccessToken = response.data.access;\n      localStorage.setItem(\"accessToken\", newAccessToken);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${newAccessToken}`;\n      originalRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n      return axios(originalRequest);\n    } catch (refreshError) {\n      console.error(\"Не удалось обновить токен\", refreshError);\n      localStorage.clear();\n      window.location.href = \"/login\";\n    }\n  }\n  throw error;\n});","map":{"version":3,"names":["axios","getAccessToken","localStorage","getItem","getRefreshToken","defaults","headers","common","interceptors","response","use","error","_error$response","originalRequest","config","status","_retry","post","refresh","newAccessToken","data","access","setItem","refreshError","console","clear","window","location","href"],"sources":["/Users/egortujmukov/Desktop/React/GameShopping/gameshop/src/API/axiosConfig.ts"],"sourcesContent":["import axios from \"axios\";\nimport { error } from \"console\";\n\n\nconst getAccessToken = () => localStorage.getItem(\"accessToken\");\nconst getRefreshToken = () => localStorage.getItem(\"refreshToken\");\n\naxios.defaults.headers.common['Authorization'] = `Bearer ${getAccessToken()}`;\n\n\naxios.interceptors.response.use(\n    (response) => response,\n    async (error) => {\n        const originalRequest = error.config;\n\n        if (\n            error.response?.status === 401 &&\n            !originalRequest._retry && getRefreshToken()\n        ) {\n            originalRequest._retry = true;\n            try {\n                const response = await axios.post(\"/api/v1/auth/token/refresh/\", {\n                    refresh: getRefreshToken(),\n                })\n                const newAccessToken = response.data.access;\n                localStorage.setItem(\"accessToken\", newAccessToken);\n                axios.defaults.headers.common['Authorization'] = `Bearer ${newAccessToken}`;\n                originalRequest.headers['Authorization'] = `Bearer ${newAccessToken}`;\n                return axios(originalRequest);\n            } catch (refreshError) {\n                console.error(\"Не удалось обновить токен\", refreshError);\n                localStorage.clear();\n                window.location.href = \"/login\";\n            }\n        }\n        throw error;\n    }\n\n)\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAIzB,MAAMC,cAAc,GAAGA,CAAA,KAAMC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;AAChE,MAAMC,eAAe,GAAGA,CAAA,KAAMF,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;AAElEH,KAAK,CAACK,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUN,cAAc,CAAC,CAAC,EAAE;AAG7ED,KAAK,CAACQ,YAAY,CAACC,QAAQ,CAACC,GAAG,CAC1BD,QAAQ,IAAKA,QAAQ,EACtB,MAAOE,KAAK,IAAK;EAAA,IAAAC,eAAA;EACb,MAAMC,eAAe,GAAGF,KAAK,CAACG,MAAM;EAEpC,IACI,EAAAF,eAAA,GAAAD,KAAK,CAACF,QAAQ,cAAAG,eAAA,uBAAdA,eAAA,CAAgBG,MAAM,MAAK,GAAG,IAC9B,CAACF,eAAe,CAACG,MAAM,IAAIZ,eAAe,CAAC,CAAC,EAC9C;IACES,eAAe,CAACG,MAAM,GAAG,IAAI;IAC7B,IAAI;MACA,MAAMP,QAAQ,GAAG,MAAMT,KAAK,CAACiB,IAAI,CAAC,6BAA6B,EAAE;QAC7DC,OAAO,EAAEd,eAAe,CAAC;MAC7B,CAAC,CAAC;MACF,MAAMe,cAAc,GAAGV,QAAQ,CAACW,IAAI,CAACC,MAAM;MAC3CnB,YAAY,CAACoB,OAAO,CAAC,aAAa,EAAEH,cAAc,CAAC;MACnDnB,KAAK,CAACK,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUY,cAAc,EAAE;MAC3EN,eAAe,CAACP,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUa,cAAc,EAAE;MACrE,OAAOnB,KAAK,CAACa,eAAe,CAAC;IACjC,CAAC,CAAC,OAAOU,YAAY,EAAE;MACnBC,OAAO,CAACb,KAAK,CAAC,2BAA2B,EAAEY,YAAY,CAAC;MACxDrB,YAAY,CAACuB,KAAK,CAAC,CAAC;MACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;IACnC;EACJ;EACA,MAAMjB,KAAK;AACf,CAEJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}